event.load("entity_click");
gamesworld = world.getGames();

lore_list = list.new();
list.add(lore_list, text.new("§aLeftclick §f= §eBuy"));
list.add(lore_list, text.new("§cRightclick §f= §eSell"));
emerald = item.create("EMERALD", 1, "§fMarket", lore_list);
quest_book = item.create("ENCHANTED_BOOK", 1, "§eQuests", null);
scroll = item.custom.create("SCROLL", 1, "§2Skills", null);
spyglass = item.create("SPYGLASS", 1, "§2Challenges", null);

anna_inv = createMainMenu("Anna", false, true, false, false);
farmer_inv = createMainMenu("Farmer", true, true, false, false);
fisher_inv = createMainMenu("Fisher", true, false, false, false);
miner_inv = createMainMenu("Miner", true, true, false, false);
baker_inv = createMainMenu("Baker", true, true, false, false);
alena_inv = createMainMenu("Alena", true, false, false, false);
mason_inv = createMainMenu("Mason", true, false, false, false);
priest_inv = createMainMenu("Priest", true, false, false, false);
mage_inv = createMainMenu("Mage", true, false, true, false);
lumberjack_inv = createMainMenu("Lumberjack", true, true, true, true);
butcher_inv = createMainMenu("Butcher", true, false, false, true);
librarian_inv = createMainMenu("Librarian", true, false, false, true);
nether_inv = createMainMenu("Nether Merchant", true, false, false, false);
diver_inv = createMainMenu("Diver", true, false, false, false);
mage_guard_inv = createMainMenu("Mage Guard", false, true, false, false);

skins = map.new();
addSkin("notch", "ewogICJ0aW1lc3RhbXAiIDogMTYyNDUyNjI0NjM2MywKICAicHJvZmlsZUlkIiA6ICIwNjlhNzlmNDQ0ZTk0NzI2YTViZWZjYTkwZTM4YWFmNSIsCiAgInByb2ZpbGVOYW1lIiA6ICJOb3RjaCIsCiAgInNpZ25hdHVyZVJlcXVpcmVkIiA6IHRydWUsCiAgInRleHR1cmVzIiA6IHsKICAgICJTS0lOIiA6IHsKICAgICAgInVybCIgOiAiaHR0cDovL3RleHR1cmVzLm1pbmVjcmFmdC5uZXQvdGV4dHVyZS8yOTIwMDlhNDkyNWI1OGYwMmM3N2RhZGMzZWNlZjA3ZWE0Yzc0NzJmNjRlMGZkYzMyY2U1NTIyNDg5MzYyNjgwIgogICAgfQogIH0KfQ==", "K76X+5wYgbcKhUxr5ZJuF4MXquYNPM5ypUf6DdNz2k0+XaJlobLVVdETe2LotlHyj6ABoU3//8mGZnfwhdj2BiulOErpB6cQR4pMmIrW6T3TLCt4L8d9juQy7xy7Dw9sQngXWm2h3Cazm+205qa0apnvA/i+IGv+WeutP52kfGhJBAN7uBUQaut0NWBfFPL8Jo7DhwBvWf/KWVpcT9UcVQuS/dVP/VE0rrTTSf3x2/jGI0ksBEdOz5lROARCHwOA1sRDvP1nQHhZD1Uekj4Bmo6rsAjJCrzr++nK2IcaPMv1uTLv0sbsGe4JF884rqWHYzs7/Cc5lGv8FNy+QjHmTcISfjnlxwJIkI48KOmAjuaova+tU1gBHRFHqJR186Vw8gtIGHusitFr6rUuutODaHyJ1C9VnItyk5RF3eznsh+uUHSkT9NOCTAhx11UhaFjlIHgqHG3rRVmeFWyEKHE8Pk2yEAlROGPedp+oYEwMFbM97Q+og7W/RtSH+kYl9vNwpLrQEG2F0bQUtulwQrWzk8T2fKgPHncZIDS2YvQjrrHjjlG0bLbiakHGvRrMrLbrVtmQrKjOjLuc5j4M/quMoZpFz98q4uftCmNOyN9ZmoEjgFv5fOdsJDGJawSaug9VEieCWhuuPnXPx19GpT1TRzGRjDW9DqO08kNeCcRxq0=");
addSkin("xmas_girl", "ewogICJ0aW1lc3RhbXAiIDogMTU5NjIyODQ5NDI0NiwKICAicHJvZmlsZUlkIiA6ICJhMjk1ODZmYmU1ZDk0Nzk2OWZjOGQ4ZGE0NzlhNDNlZSIsCiAgInByb2ZpbGVOYW1lIiA6ICJWaWVydGVsdG9hc3RpaWUiLAogICJzaWduYXR1cmVSZXF1aXJlZCIgOiB0cnVlLAogICJ0ZXh0dXJlcyIgOiB7CiAgICAiU0tJTiIgOiB7CiAgICAgICJ1cmwiIDogImh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvOWUwYjJmNzg5NDZkZThmZjg4YzFkYzI2OTkwMTgxNTEzMjE1NzQ3NDZmZjg1ZjQ1Y2U5Nzk1YzZmMjc4NDNiNyIsCiAgICAgICJtZXRhZGF0YSIgOiB7CiAgICAgICAgIm1vZGVsIiA6ICJzbGltIgogICAgICB9CiAgICB9CiAgfQp9", "kDLavxU1Et/E6Gak3MaUHsqrH91LcQyxNUy1hG8Vr/0CL4uqWXMYFT1SP9VDrkPbfnzpqQIDG7uTfEsIwrMS0fpsMugdEmlwXv4Omcc+4j6VYT1BNvchNrxyvc4otsY9fTjMHfyxvmTB2yjUQdlJEjHPKw17cbH2lpFgEiNi1SM+V+IVHfg/gXnEufjYaTek+3uNd6UUiukc6S6MTeGcstJ3qJh5DUk/PJKWqapgoVqBGFmFoyqPgb0Ns2LEqvKPJc+uGvB6FpUPLYkqC+8HokYnBTxAFOF0803Xh4y0E17I+GckFGJsa2EP40g0oj2aFnua+lchAU1d0B8RkN2u0yD4bqELQjjxLj26qnDvl6V3aJ00KD/BCIiaPMxfyYKI5BFceFRYU2qwNX83LorkFIzuFDhRtn1jyYn5fDGN3CtSdQ60q733N3jXA14sUntrKiIEUrwu+HN2Qo2765skEiXoBMc7blHfgh0RFt4g/S021xd1gyid7ZqftG5TXeyvGZQH3XuQcdZ6o1nB8g2mnT1w36wGaIcUdCV5VWD9YxI1zjbNKeAONpHOFmgZxgJpJGaaYqJeJe4KgtPlxM6WTQ6g6U60bG14IZ5ZRfbAggb3jOaTYAH0tIahOaKO9/2POR+hRVIQ2lpQE7iOsPWQOoBIV8fy8pQMhsvWuqKcrww=");

citizens = list.new();
//gamesspawn
addCitizen("marvinius", loc.new(gamesworld, -409.5, 161, -59.5), null);
addCitizen("eropster", loc.new(gamesworld, -303.5, 157, -41.5), null);
//shoppingchaos
addCitizen("Recipes", loc.new(gamesworld, -2.5, 101, 2984.5), "xmas_girl");
addCitizen("Recipes", loc.new(gamesworld, 3.5, 101, 3016.5), "xmas_girl");
addCitizen("Recipes", loc.new(gamesworld, 16.5, 101, 2997.5), "xmas_girl");
addCitizen("Recipes", loc.new(gamesworld, -15.5, 101, 3003.5), "xmas_girl");
addCitizen("Shop", loc.new(gamesworld, 0.5, 101, 2993.5), "xmas_girl"); //Team 1
addCitizen("Shop", loc.new(gamesworld, 2.5, 101, 2993.5), "xmas_girl");
addCitizen("Shop", loc.new(gamesworld, -1.5, 101, 2993.5), "xmas_girl");
addCitizen("Shop", loc.new(gamesworld, 0.5, 101, 3007.5), "xmas_girl"); //Team 2
addCitizen("Shop", loc.new(gamesworld, -1.5, 101, 3007.5), "xmas_girl");
addCitizen("Shop", loc.new(gamesworld, 2.5, 101, 3007.5), "xmas_girl");
addCitizen("Shop", loc.new(gamesworld, 7.5, 101, 3000.5), "xmas_girl"); //Team 3
addCitizen("Shop", loc.new(gamesworld, 7.5, 101, 3002.5), "xmas_girl");
addCitizen("Shop", loc.new(gamesworld, 7.5, 101, 2998.5), "xmas_girl");
addCitizen("Shop", loc.new(gamesworld, -6.5, 101, 3000.5), "xmas_girl"); //Team 4
addCitizen("Shop", loc.new(gamesworld, -6.5, 101, 2998.5), "xmas_girl");
addCitizen("Shop", loc.new(gamesworld, -6.5, 101, 3002.5), "xmas_girl");
//bedwars

initCitizens();

msg.string("dev", "§bHumans §rloaded.");
@main
wait();
ignoreGoto(event);
goto("main");

@entity_click
if(slot.isOffHand(hand)) {
	goto("main");
}
if(!isCitizen(entity)) {
	goto("main");
}
entity_name = entity.getName(entity);
string_name = string.text(entity_name);
if(string_name == "Farmer") {
	inv.open(farmer_inv, player);
} elseif(string_name == "Anna") {
	inv.open(anna_inv, player);
} elseif(string_name == "Miner") {
	inv.open(miner_inv, player);
} elseif(string_name == "Fisher") {
	inv.open(fisher_inv, player);
} elseif(string_name == "Baker") {
	inv.open(baker_inv, player);
} elseif(string_name == "Alena") {
	inv.open(alena_inv, player);
} elseif(string_name == "Mason") {
	inv.open(mason_inv, player);
} elseif(string_name == "Priest") {
	inv.open(priest_inv, player);
} elseif(string_name == "Mage") {
	inv.open(mage_inv, player);
} elseif(string_name == "Lumberjack") {
	inv.open(lumberjack_inv, player);
} elseif(string_name == "Butcher") {
	inv.open(butcher_inv, player);
} elseif(string_name == "Librarian") {
	inv.open(librarian_inv, player);
} elseif(string_name == "Nether Merchant") {
	inv.open(nether_inv, player);
} elseif(string_name == "Diver") {
	inv.open(diver_inv, player);
} elseif(string_name == "Mage Guard") {
	inv.open(mage_guard_inv, player);
}
goto("main");

function createMainMenu(inv_name, market, quests, skills, challenges) {
	inv = inv.new("222222222", text.new(inv_name));
	index = 0;
	if(market) {
		inv.setItem(inv, index++, $emerald);
	}
	if(quests) {
		inv.setItem(inv, index++, $quest_book);
	}
	if(skills) {
		inv.setItem(inv, index++, $scroll);
	}
	if(challenges) {
		inv.setItem(inv, index++, $spyglass);
	}
	return inv;
}

function addSkin(skin_name, texture_value, texture_signature) {
	a = array.new(2);
	a[0] = texture_value;
	a[1] = texture_signature;
	map.add($skins, skin_name, a);
}

function addCitizen(name, loc, skin_name) {
	a = array.new(3);
	a[0] = name;
	a[1] = loc;
	a[2] = skin_name;
	list.add($citizens, a);
}

function initCitizens() {
	iter = iterator($citizens);
	while(hasNext(iter)) {
		a = next(iter);
		name = a[0];
		loc = a[1];
		skin_name = a[2];
		//check if citizen is at the location
		l = entity.near(loc, 0.7);
		if(list.getSize(l) > 0) {
			c = list.getIndex(l, 0);
			if(isCitizen(c)) {
				//at the location a citizen exists already
				continue;
			}
		}
		//spawn citizen
		c = citizen.spawn(loc, name);
		if(skin_name != null) {
			msg.dev(skin_name);
			a_skin = map.get($skins, skin_name);
			msg.dev(c);
			msg.dev(a_skin);
			citizen.setSkin(c, a_skin[0], a_skin[1]);
		}
		citizen.lookclose(c);
	}
}
